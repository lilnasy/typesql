import type { Database } from 'better-sqlite3';

export type Select04Params = {
	date: Date;
}

export type Select04Result = {
	text_column?: string;
	date_text?: Date;
	integer_column?: number;
	date_integer?: Date;
}

export function select04(db: Database, params: Select04Params): Select04Result[] {
	const sql = `
	SELECT 
		text_column, 
		date(text_column) as date_text,
		integer_column,
		date(integer_column, 'auto') as date_integer
	FROM all_types 
	WHERE date(text_column) = ?
	AND date(integer_column, 'auto') = ?
	`
	return db.prepare(sql)
		.raw(true)
		.all([params.date?.toISOString(), params.date?.toISOString()])
		.map(data => mapArrayToSelect04Result(data));
}

function mapArrayToSelect04Result(data: any) {
	const result: Select04Result = {
		text_column: data[0],
		date_text: data[1] != null ? new Date(data[1]) : data[1],
		integer_column: data[2],
		date_integer: data[3] != null ? new Date(data[3]) : data[3]
	}
	return result;
}